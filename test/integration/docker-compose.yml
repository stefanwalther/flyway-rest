version: '2'
services:
  flyway_rest_db:
    container_name: 'flyway_rest_db'
    image: postgres:9.6
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=usr
      - POSTGRES_PWD=pwd
      - POSTGRES_DB=flyway
  flyway_rest_service:
    container_name: 'flyway_rest_service'
    build: ./../../.
    links:
      - flyway_rest_db
    environment:
      - PORT=9001
    ports:
      - "9001:9001"
    command: "npm run start"
  flyway_rest_integration:
    container_name: 'flyway_rest_integration'
    build:
      context: ./../../.
      dockerfile: ./test/integration/Dockerfile
    environment:
      - FLYWAY_REST_PORT=9001
      - FLYWAY_REST_HOST=flyway_rest_service
    depends_on:
      - flyway_rest_service
    command: npm run test:integration
#    command: while true; echo .; do sleep 1000; done
